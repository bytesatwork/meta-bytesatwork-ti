From b2228a81cef9114354624bb392f90852e23c65d8 Mon Sep 17 00:00:00 2001
From: Rico Ganahl <rico.ganahl@bytesatwork.ch>
Date: Wed, 2 Aug 2023 08:31:04 +0200
Subject: [PATCH] arm: dts: bytedevkit: Adapt binman configuration

Generate images with binman instead of TI's k3-image-gen.

Signed-off-by: Rico Ganahl <rico.ganahl@bytesatwork.ch>
---
 arch/arm/dts/k3-am625-bytedevkit-binman.dtsi | 92 ++++++++++----------
 1 file changed, 47 insertions(+), 45 deletions(-)

diff --git a/arch/arm/dts/k3-am625-bytedevkit-binman.dtsi b/arch/arm/dts/k3-am625-bytedevkit-binman.dtsi
index 683f8dd20d..4b0856be2f 100644
--- a/arch/arm/dts/k3-am625-bytedevkit-binman.dtsi
+++ b/arch/arm/dts/k3-am625-bytedevkit-binman.dtsi
@@ -1,5 +1,7 @@
 // SPDX-License-Identifier: GPL-2.0
 /*
+ * Copyright (C) 2023 bytes at work AG - https://www.bytesatwork.io
+ * based on k3-binman.dtsi and k3-am625-sk-binman.dtsi
  * Copyright (C) 2022 Texas Instruments Incorporated - https://www.ti.com/
  */
 
@@ -13,14 +15,14 @@
 	custMpk {
 		filename = "custMpk.pem";
 		blob-ext {
-			filename = "../keys/custMpk.pem";
+			filename = "../../ti/keys/custMpk.pem";
 		};
 	};
 
 	ti-degenerate-key {
 		filename = "ti-degenerate-key.pem";
 		blob-ext {
-			filename = "../keys/ti-degenerate-key.pem";
+			filename = "../../ti/keys/ti-degenerate-key.pem";
 		};
 	};
 };
@@ -32,28 +34,28 @@
 		filename = "board-cfg.bin";
 		bcfg_yaml: ti-board-config {
 			config = "board-cfg.yaml";
-			schema = "../common/schema.yaml";
+			schema = "../../ti/common/schema.yaml";
 		};
 	};
 	pm-cfg {
 		filename = "pm-cfg.bin";
 		rcfg_yaml: ti-board-config {
 			config = "pm-cfg.yaml";
-			schema = "../common/schema.yaml";
+			schema = "../../ti/common/schema.yaml";
 		};
 	};
 	rm-cfg {
 		filename = "rm-cfg.bin";
 		pcfg_yaml: ti-board-config {
 			config = "rm-cfg.yaml";
-			schema = "../common/schema.yaml";
+			schema = "../../ti/common/schema.yaml";
 		};
 	};
 	sec-cfg {
 		filename = "sec-cfg.bin";
 		scfg_yaml: ti-board-config {
 			config = "sec-cfg.yaml";
-			schema = "../common/schema.yaml";
+			schema = "../../ti/common/schema.yaml";
 		};
 	};
 	combined-tifs-cfg {
@@ -61,19 +63,19 @@
 		ti-board-config {
 			bcfg_yaml_tifs: board-cfg {
 				config = "board-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			scfg_yaml_tifs: sec-cfg {
 				config = "sec-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			pcfg_yaml_tifs: pm-cfg {
 				config = "pm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			rcfg_yaml_tifs: rm-cfg {
 				config = "rm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 		};
 	};
@@ -82,11 +84,11 @@
 		ti-board-config {
 			pcfg_yaml_dm: pm-cfg {
 				config = "pm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			rcfg_yaml_dm: rm-cfg {
 				config = "rm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 		};
 	};
@@ -95,19 +97,19 @@
 		ti-board-config {
 			board-cfg {
 				config = "board-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			sec-cfg {
 				config = "sec-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			pm-cfg {
 				config = "pm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 			rm-cfg {
 				config = "rm-cfg.yaml";
-				schema = "../common/schema.yaml";
+				schema = "../../ti/common/schema.yaml";
 			};
 		};
 	};
@@ -115,11 +117,11 @@
 
 #endif
 
-#ifdef CONFIG_TARGET_AM625_R5_EVM
+#ifdef CONFIG_TARGET_AM62X_BYTEDEVKIT_R5
 
 &binman {
-	tiboot3-am62x-hs-evm.bin {
-		filename = "tiboot3-am62x-hs-evm.bin";
+	tiboot3-am62x-hs-bytedevkit.bin {
+		filename = "tiboot3-am62x-hs-bytedevkit.bin";
 		ti-secure-rom {
 			content = <&u_boot_spl>, <&ti_fs_enc>, <&combined_tifs_cfg>,
 				<&combined_dm_cfg>, <&sysfw_inner_cert>;
@@ -163,9 +165,8 @@
 };
 
 &binman {
-	tiboot3-am62x-hs-fs-evm.bin {
-		filename = "tiboot3-am62x-hs-fs-evm.bin";
-		symlink = "tiboot3.bin";
+	tiboot3-am62x-hs-fs-bytedevkit.bin {
+		filename = "tiboot3-am62x-hs-fs-bytedevkit.bin";
 		ti-secure-rom {
 			content = <&u_boot_spl_fs>, <&ti_fs_enc_fs>, <&combined_tifs_cfg_fs>,
 				<&combined_dm_cfg_fs>, <&sysfw_inner_cert_fs>;
@@ -209,8 +210,9 @@
 };
 
 &binman {
-	tiboot3-am62x-gp-evm.bin {
-		filename = "tiboot3-am62x-gp-evm.bin";
+	tiboot3-am62x-gp-bytedevkit.bin {
+		filename = "tiboot3-am62x-gp-bytedevkit.bin";
+		symlink = "tiboot3.bin";
 		ti-secure-rom {
 			content = <&u_boot_spl_unsigned>, <&ti_fs_gp>,
 				<&combined_tifs_cfg_gp>, <&combined_dm_cfg_gp>;
@@ -249,13 +251,13 @@
 
 #endif
 
-#ifdef CONFIG_TARGET_AM625_A53_EVM
+#ifdef CONFIG_TARGET_AM62X_BYTEDEVKIT_A53
 
 #define SPL_NODTB "spl/u-boot-spl-nodtb.bin"
-#define SPL_AM625_SK_DTB "spl/dts/k3-am625-sk.dtb"
+#define SPL_AM625_BYTEDEVKIT_DTB "spl/dts/k3-am625-bytedevkit.dtb"
 
 #define UBOOT_NODTB "u-boot-nodtb.bin"
-#define AM625_SK_DTB "u-boot.dtb"
+#define AM625_BYTEDEVKIT_DTB "u-boot.dtb"
 
 &binman {
 	ti-dm {
@@ -436,16 +438,16 @@
 				};
 
 				fdt-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					type = "flat_dt";
 					arch = "arm";
 					compression = "none";
 					ti-secure {
-						content = <&spl_am625_sk_dtb>;
+						content = <&spl_am625_bytedevkit_dtb>;
 						keyfile = "custMpk.pem";
 					};
-					spl_am625_sk_dtb: blob-ext {
-						filename = SPL_AM625_SK_DTB;
+					spl_am625_bytedevkit_dtb: blob-ext {
+						filename = SPL_AM625_BYTEDEVKIT_DTB;
 					};
 
 				};
@@ -456,7 +458,7 @@
 				default = "conf-0";
 
 				conf-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					firmware = "atf";
 					loadables = "tee", "fsstub-hs", "fsstub-fs",
 						  "fsstub-gp", "dm", "spl";
@@ -495,16 +497,16 @@
 				};
 
 				fdt-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					type = "flat_dt";
 					arch = "arm";
 					compression = "none";
 					ti-secure {
-						content = <&am625_sk_dtb>;
+						content = <&am625_bytedevkit_dtb>;
 						keyfile = "custMpk.pem";
 					};
-					am625_sk_dtb: blob-ext {
-						filename = AM625_SK_DTB;
+					am625_bytedevkit_dtb: blob-ext {
+						filename = AM625_BYTEDEVKIT_DTB;
 					};
 					hash {
 						algo = "crc32";
@@ -516,7 +518,7 @@
 				default = "conf-0";
 
 				conf-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					firmware = "uboot";
 					loadables = "uboot";
 					fdt = "fdt-0";
@@ -630,12 +632,12 @@
 				};
 
 				fdt-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					type = "flat_dt";
 					arch = "arm";
 					compression = "none";
-					spl_am625_sk_dtb_unsigned: blob {
-						filename = SPL_AM625_SK_DTB;
+					spl_am625_bytedevkit_dtb_unsigned: blob {
+						filename = SPL_AM625_BYTEDEVKIT_DTB;
 					};
 				};
 			};
@@ -644,7 +646,7 @@
 				default = "conf-0";
 
 				conf-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					firmware = "atf";
 					loadables = "tee", "fsstub-hs", "fsstub-fs",
 						  "fsstub-gp", "dm", "spl";
@@ -680,12 +682,12 @@
 				};
 
 				fdt-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					type = "flat_dt";
 					arch = "arm";
 					compression = "none";
-					am625_sk_dtb_unsigned: blob {
-						filename = AM625_SK_DTB;
+					am625_bytedevkit_dtb_unsigned: blob {
+						filename = AM625_BYTEDEVKIT_DTB;
 					};
 					hash {
 						algo = "crc32";
@@ -697,7 +699,7 @@
 				default = "conf-0";
 
 				conf-0 {
-					description = "k3-am625-sk";
+					description = "k3-am625-bytedevkit";
 					firmware = "uboot";
 					loadables = "uboot";
 					fdt = "fdt-0";
-- 
2.39.2


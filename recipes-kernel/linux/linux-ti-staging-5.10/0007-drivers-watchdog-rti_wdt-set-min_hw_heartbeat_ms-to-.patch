From ccee33b6ab0581108e6e9b34a070f980d07b801f Mon Sep 17 00:00:00 2001
From: Markus Kappeler <markus.kappeler@bytesatwork.ch>
Date: Mon, 1 May 2023 19:15:12 +0200
Subject: [PATCH] drivers: watchdog: rti_wdt: set min_hw_heartbeat_ms to 51%

When watchdog is triggered within the 50% then the system reboots.
So setting the min_hw_heartbeat_ms property to 51% to relax it.

Signed-off-by: Markus Kappeler <markus.kappeler@bytesatwork.ch>
---
 drivers/watchdog/rti_wdt.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/watchdog/rti_wdt.c b/drivers/watchdog/rti_wdt.c
index 46c2a4bd9ebe..7f13263295db 100644
--- a/drivers/watchdog/rti_wdt.c
+++ b/drivers/watchdog/rti_wdt.c
@@ -84,8 +84,10 @@ static int rti_wdt_start(struct watchdog_device *wdd)
 	 * The HW configuration options only allow for the open window size
 	 * to be 50% or less than that; we obviouly want to configure the open
 	 * window as large as possible so we select the 50% option.
+	 * Set some margin for the min_hw_heartbeat_ms to 51% to be in no case
+	 * to early.
 	 */
-	wdd->min_hw_heartbeat_ms = 500 * wdd->timeout;
+	wdd->min_hw_heartbeat_ms = 510 * wdd->timeout;
 
 	/* Generate NMI when wdt expires */
 	writel_relaxed(RTIWWDRX_NMI, wdt->base + RTIWWDRXCTRL);
-- 
2.39.2


From 2e30a14ca0a79d60a81bdd6ccdca6b75797e5c88 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Stephan=20D=C3=BCnner?= <stephan.duenner@bytesatwork.ch>
Date: Mon, 5 Jun 2023 08:44:46 +0200
Subject: [PATCH] arm64: ti: k3-am625-bytedevkit: Add support for touch sensor
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

It is based on the goodix gt911.

Signed-off-by: Stephan DÃ¼nner <stephan.duenner@bytesatwork.ch>
---
 .../arm64/boot/dts/ti/k3-am625-bytedevkit.dts | 28 +++++++++++++++++--
 1 file changed, 26 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/ti/k3-am625-bytedevkit.dts b/arch/arm64/boot/dts/ti/k3-am625-bytedevkit.dts
index 242f22a098bc..ae7fd98738cf 100644
--- a/arch/arm64/boot/dts/ti/k3-am625-bytedevkit.dts
+++ b/arch/arm64/boot/dts/ti/k3-am625-bytedevkit.dts
@@ -65,8 +65,8 @@ AM62X_IOPAD(0x1cc, PIN_OUTPUT, 0) /* (E14) UART0_TXD */
 
 	main_i2c1_pins_default: main-i2c1-pins-default {
 		pinctrl-single,pins = <
-			AM62X_IOPAD(0x1e8, PIN_INPUT_PULLUP, 0) /* (B17) I2C1_SCL */
-			AM62X_IOPAD(0x1ec, PIN_INPUT_PULLUP, 0) /* (A17) I2C1_SDA */
+			AM62X_IOPAD(0x1e8, PIN_INPUT, 0) /* (B17) I2C1_SCL */
+			AM62X_IOPAD(0x1ec, PIN_INPUT, 0) /* (A17) I2C1_SDA */
 		>;
 	};
 
@@ -150,6 +150,13 @@ AM62X_IOPAD(0x19c, PIN_OUTPUT, 7) /* (B18) GPIO1_9 Display2 pwm */
 			AM62X_IOPAD(0x174, PIN_OUTPUT, 7) /* (AD21) GPIO0_91 Display2 enable */
 		>;
 	};
+
+	touch_pins_default: touch-pins-default {
+		pinctrl-single,pins = <
+			AM62X_IOPAD(0x1d0, PIN_OUTPUT, 7) /* (A15) GPIO1_22 UART0_CTSN Touch Rst */
+			AM62X_IOPAD(0x1d4, PIN_INPUT, 7) /* (B15) GPIO1_23 UART0_RTSN Touch Int */
+		>;
+	};
 };
 
 &main_uart0 {
@@ -229,3 +236,20 @@ oldi_out0: endpoint {
 		};
 	};
 };
+
+&main_i2c1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&main_i2c1_pins_default
+		     &touch_pins_default>;
+	clock-frequency = <400000>;
+	status = "okay";
+
+	gt911@5d {
+		compatible = "goodix,gt911";
+		reg = <0x5d>;
+		interrupt-parent = <&main_gpio1>;
+		interrupts = <23 0>;
+		irq-gpios = <&main_gpio1 23 0>;
+		reset-gpios = <&main_gpio1 22 0>;
+	};
+};
-- 
2.39.2

